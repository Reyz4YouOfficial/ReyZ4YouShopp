<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REYZ_AI | NEURAL_LINK</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Share+Tech+Mono&family=Rajdhani:wght@600&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --cyan: #00f0ff; --yellow: #fcee0a; --bg: #050505; }
        body { background: var(--bg); font-family: 'Rajdhani', sans-serif; color: white; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        /* Background Grid Efek Cyber */
        body::before {
            content: ""; position: fixed; inset: 0;
            background-image: linear-gradient(rgba(0, 240, 255, 0.05) 1px, transparent 1px), linear-gradient(90(rgba(0, 240, 255, 0.05) 1px, transparent 1px));
            background-size: 30px 30px; z-index: -1;
        }

        .header { border-bottom: 2px solid var(--cyan); background: rgba(0, 240, 255, 0.05); backdrop-filter: blur(10px); }
        .chat-area { flex: 1; overflow-y: auto; padding: 20px; font-family: 'Share Tech Mono'; scroll-behavior: smooth; }
        
        /* Bubble Chat Style */
        .msg { margin-bottom: 20px; padding: 12px; max-width: 85%; position: relative; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        .msg-ai { border-left: 3px solid var(--cyan); background: rgba(0, 240, 255, 0.05); color: var(--cyan); }
        .msg-user { border-right: 3px solid var(--yellow); background: rgba(252, 238, 10, 0.05); color: var(--yellow); margin-left: auto; text-align: right; }

        .typing { font-style: italic; font-size: 10px; color: #555; margin-top: 5px; }
        .input-area { background: #0a0a0a; border-top: 1px solid #333; padding: 20px; }
        
        /* Scrollbar ala Cyberpunk */
        .chat-area::-webkit-scrollbar { width: 4px; }
        .chat-area::-webkit-scrollbar-thumb { background: var(--cyan); }
    </style>
</head>
<body>

    <div class="header p-4 flex justify-between items-center z-10">
        <button onclick="window.location.href='/dashboard'" class="text-cyan-400 text-xs font-bold uppercase hover:bg-cyan-500/10 p-2">
            <i class="fas fa-chevron-left"></i> EXIT_CHAT
        </button>
        <div class="text-center">
            <h1 class="text-sm font-black text-yellow-400 tracking-[0.3em]" style="font-family:'Orbitron'">NEURAL_CHAT_v2</h1>
            <p id="status" class="text-[8px] text-green-500 animate-pulse font-mono">‚óè SYSTEM_ONLINE</p>
        </div>
        <div class="w-8 h-8 rounded-full border border-cyan-500 flex items-center justify-center">
            <i class="fas fa-robot text-cyan-400"></i>
        </div>
    </div>

    <div id="chat-box" class="chat-area flex flex-col space-y-4">
        </div>

    <div class="input-area">
        <div class="max-w-3xl mx-auto flex gap-3">
            <input type="text" id="ai-input" 
                   class="flex-1 bg-black border border-cyan-900 text-white p-3 text-sm outline-none focus:border-cyan-400 transition-all font-mono" 
                   placeholder="Masukkan pesan atau perintah..." 
                   onkeypress="if(event.key === 'Enter') askAI()">
            
            <button onclick="askAI()" class="bg-cyan-500 text-black px-6 font-black uppercase text-xs hover:bg-white hover:shadow-[0_0_15px_#fff] transition-all">
                SEND
            </button>
        </div>
        <p class="text-[8px] text-gray-700 text-center mt-3 tracking-[0.5em] uppercase font-mono">Encrypted Connection: Reyz_Neural_Link</p>
    </div>

    <script>
        const user = localStorage.getItem('currentUser') || "USER";
        const box = document.getElementById('chat-box');

        // Sambutan pertama saat halaman dibuka
        window.onload = () => {
            if(localStorage.getItem('isLoggedIn') !== 'true') window.location.href = "/";
            
            setTimeout(() => {
                box.innerHTML += `
                    <div class="msg msg-ai shadow-[0_0_10px_rgba(0,240,255,0.05)]">
                        <span class="text-[9px] block mb-1 opacity-50 uppercase tracking-widest">Reyz_AI:</span>
                        Selamat datang kembali, <b>${user}</b>. Neural Link sudah stabil. Ada yang bisa saya bantu terkait produk di ReyZ4YouXGod?
                    </div>
                `;
            }, 500);
        };

        async function askAI() {
            const inp = document.getElementById('ai-input');
            const q = inp.value.trim();
            if(!q) return;

            // 1. Tampilkan Chat User
            box.innerHTML += `
                <div class="msg msg-user shadow-[0_0_10px_rgba(252,238,10,0.05)]">
                    <span class="text-[9px] block mb-1 opacity-50 uppercase tracking-widest">${user}:</span>
                    ${q}
                </div>
            `;
            inp.value = '';
            
            // Auto Scroll ke Bawah
            box.scrollTop = box.scrollHeight;

            // 2. Tampilkan Loading AI
            const loadId = "ai-" + Date.now();
            box.innerHTML += `
                <div id="${loadId}" class="msg msg-ai animate-pulse">
                    <span class="text-[9px] block mb-1 opacity-50 uppercase tracking-widest">Reyz_AI:</span>
                    <i class="fas fa-circle-notch fa-spin"></i> Processing...
                </div>
            `;
            box.scrollTop = box.scrollHeight;

            try {
                // 3. Ambil Jawaban dari Backend api/ai.js
                const res = await fetch('/api/ai.js', { 
                    method: 'POST', 
                    headers: { 'Content-Type': 'application/json' }, 
                    body: JSON.stringify({ prompt: q }) 
                });
                const data = await res.json();
                
                // 4. Update Pesan AI dengan Jawaban Asli
                const aiMsg = document.getElementById(loadId);
                aiMsg.classList.remove('animate-pulse');
                aiMsg.innerHTML = `
                    <span class="text-[9px] block mb-1 opacity-50 uppercase tracking-widest">Reyz_AI:</span>
                    ${data.reply}
                `;

            } catch (err) {
                document.getElementById(loadId).innerHTML = `
                    <span class="text-[9px] block mb-1 opacity-50 uppercase tracking-widest">Reyz_AI:</span>
                    <span class="text-red-500 font-bold">ERROR_OFFLINE: Gagal terhubung ke server neural.</span>
                `;
            }
            
            // Auto Scroll Akhir
            box.scrollTop = box.scrollHeight;
        }
    </script>
</body>
</html>
